# name: Rust Build and Windows Artifact

# on:
#   push:
#     branches: [ "master" ]
#   pull_request:
#     branches: [ "master" ]

# env:
#   CARGO_TERM_COLOR: always
#   SFML_INCLUDE_DIR: /usr/include2
#   SFML_LIBS_DIR: /usr/lib/x86_64-linux-gnu

# jobs:
#   build:

#     runs-on: ubuntu-latest

#     steps:
#     - uses: actions/checkout@v4

#     - name: Install prerequisites
#       run: sudo apt-get update && sudo apt-get install -y mingw-w64 && sudo apt install -y libsfml-dev libcsfml-dev && sudo apt install -y build-essential cmake git libx11-dev freeglut3-dev libxcb-image0-dev libudev-dev libjpeg8-dev libopenal-dev libsndfile1-dev libfreetype6-dev gcc-multilib

#     - name: üòê
#       run: |
#         sudo mkdir /usr/include2
#         sudo cp -r /usr/include/SFML /usr/include2/SFML
#         ls /usr/lib/x86_64-linux-gnu | grep sfml

#     - name: whatever
#       run: |
#         cargo build -vv

#     - name: Build for Windows
#       run: |
#         echo $LD_LIBRARY_PATH
#         rustup target add x86_64-pc-windows-gnu
#         cargo build --target x86_64-pc-windows-gnu --release --verbose

#     - name: Package artifacts
#       run: |
#         mkdir artifacts
#         cp target/x86_64-pc-windows-gnu/release/bin.exe artifacts/
#         cd artifacts
#         zip -r bin.zip bin.exe

#     - name: Upload artifact
#       uses: actions/upload-artifact@v2
#       with:
#         name: bin
#         path: artifacts/bin.zip

name: Build Rust with SFML on Windows

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build:

    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4
      
      - name: Set up MSYS2 environment
        uses: msys2/setup-msys2@v2
        with:
          msys2-root: C:/msys64
          update: true
          install: mingw-w64-x86_64-toolchain

      - name: Install SFML dependencies
        run: |
          pacman -S mingw-w64-x86_64-toolchain --noconfirm
          pacman -S mingw-w64-x86_64-sfml --noconfirm

      - name: Set SFML environment variables
        run: |
          echo "::set-env name=SFML_INCLUDE_DIR::C:/msys64/mingw64/include"
          echo "::set-env name=SFML_LIBS_DIR::C:/msys64/mingw64/lib"

      - name: Build for Windows
        run: |
          rustup target add x86_64-pc-windows-gnu
          cargo build --target x86_64-pc-windows-gnu --release --verbose

      - name: Package artifacts
        run: |
          mkdir artifacts
          cp target/x86_64-pc-windows-gnu/release/bin.exe artifacts/
          cd artifacts
          zip -r bin.zip bin.exe

      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: bin
          path: artifacts/bin.zip
